<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="user">

    <select id="findByEmail" parameterType="java.lang.String" resultType="java.util.HashMap">
        select USER_ID,
               PROVIDER,
               PROVIDER_ID,
               PROFILE_IMAGE_URL,
               EMAIL,
               NAME,
               PASSWORD,
               to_char(STATUS) as STATUS
        from kakao_users
        where EMAIL = #{email}
    </select>

    <select id="findById" parameterType="java.lang.String" resultType="java.util.HashMap">
        select USER_ID,
               PROVIDER,
               PROVIDER_ID,
               PROFILE_IMAGE_URL,
               EMAIL,
               NAME,
               PASSWORD,
               to_char(STATUS) as STATUS
        from kakao_users
        where user_id = #{id}
    </select>

    <insert id="save" parameterType="com.oauth2.sample.web.security.dto.User">
        insert into
        kakao_users (
        USER_ID,
        PROVIDER,
        NAME,
        PROFILE_IMAGE_URL,
        STATUS,
        CREATEAT,
        PROVIDER_ID,
        EMAIL,
        PASSWORD
        )
        values (
        #{id, jdbcType=VARCHAR},
        #{provider, jdbcType=VARCHAR},
        #{name, jdbcType=VARCHAR},
        #{imageUrl, jdbcType=VARCHAR},
        1,
        sysdate,
        #{providerId, jdbcType=VARCHAR},
        #{email, jdbcType=VARCHAR},
        #{password, jdbcType=VARCHAR}
        )
    </insert>

    <select id="getRefreshTokenById" parameterType="java.lang.String" resultType="java.lang.String">
        select
            REFRESH_TOKEN
        from kakao_users
        where user_id = #{id}
    </select>

    <update id="updateRefreshToken" parameterType="java.util.Map">
        update
            kakao_users
        set
            REFRESH_TOKEN = #{token}
        where user_id = #{id}
    </update>
</mapper>